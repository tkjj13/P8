\chapter{Discussion}
The discussion will follow up on the results found in \autoref{ch:mass_test} and \autoref{ch:BatTest} and suggestions are made to explain some of the findings, as well as some of the potential problems that might influence the results. 

\section{Domain: Massiveness}
It was found in \autoref{ch:mass_test} that the MDE could emulate up to 12 devices, with an error rate around the 30 $\%$. While the number of devices is not as high as wanted, the results of the execution time, CPU usage and RAM usage indicates, that the system can handle more devices. This indicates that the computer is not the limiting factor at this point. 

Looking into the MDE, multiple issues can be addressed. The biggest concern for the MDE, is that the baseline emulator is still in-development, which have given some errors, such as a struct containing the cell parameters could not initialize. Errors like these have meant that implementing new functionalities into the system has been difficult, as the origin of any error occurring, essentially was unknown. Another issue with the baseline emulator, is that is is based on the LTE version used in the previous project. This has meant the structure is very similar to the version, but with a lot of classes and functionalities still left from the LTE. This have made debugging very hard and has meant a very slow learning curve for understanding the emulator, when half of the +60 classes is not used.

When overlooking the fact, that the baseline emulator is still in development, some of the implementation has not worked as well as expected. The most frequently occurring error, as seen on \autoref{fig:MT_error_dist}, is the \textit{idle after MIB-NB}, an error not found in the baseline emulator. Under the testing phase of MDE and the baseline emulator, it was seen that the baseline emulator calls a function in the RRC class, which restart the whole synchronization step, this does not happen in the MDE. The reason for this is that instead of starting the attach procedure in the NAS class, as the baseline emulator does, the MDE starts it directly in the PHCH recv class. However when starting in the NAS class, it goes through the RRC class, which contains a counter that restart the the MIB-NB decoding, if it is taking too long. This can be solved by using a RRC class connected to the Co-Phy, but this was not implemented as the error cause was found to late.

The problem with the missing timer in the RRC is not the cause for all the cases of the \textit{idle after MIB-NB} error, especially when the number of device gets higher. An issue seen, during the development, is the receiver buffer gets out of sync, when the number of devices is to high, which causes a call to the RRC class about out of sync, that in turn resets the system back to the synchronization step. It was believed to be because the MDE was to slow at this part, but as seen from the test of the execution time for the NB-SIB1 messages, the decoding time of the NB-SIB1 message does not increase with the  number of devices. This means it is unlikely that the limit of 13 devices is caused by this and the error should be found at another area. A possible solution however will be to implement an update function for the receiver buffer, so it will always receive, when it is time.

During the devolopment the MDE successfully emulated up to 18 devices at once, but with an estimated error rate around 70\%. This conflict with the findings in \autoref{ch:mass_test}. The reason behind this could be, that the measurements tools is also using the PC resources. As mentioned before, the most common error with a higher number of devices, is the out off sync error, happening in the NB-SIB1 step. If it is a CPU usage problem, the measurement tools can have an influence on the number of devices needed to produce the error and as it is the only difference between the normal testing, while in-development and the test seen in this report, it is thought to have an influence.

Even though the achieve maximum emulated devices is lower than expected, the concept started by the previous project, has been implemented for the NB-IoT protocol. Multiple test also indicates that it should be possible, to get a higher number of devices, as seen in \autoref{ch:mass_test}. If the baseline code gets fully developed, without to many structural changes and the implementations ideas, shown later in \autoref{ch:Future}, get implemented the ideal MDE could be realized. 



\section{Domain: Energy Consumption}
It was found in \autoref{ch:BatTest} that it is possible to achieve a battery lifetime of more than 10 years on a 5 Wh battery, however it was also discovered that this was not a guarantee. It was found that to achieve this the device is only allowed to transmit for a maximum of 0.468 s per 24 hours. This does not seem like very long for a worst case scenario, where e.g. repetition could increase the transmission time of a single subframe to more than 2 seconds. 

Taking a step back to evaluate the method of finding this value, a couple of issues can be seen. The way the model is designed, limits the precision a bit. Firstly is that TX and RX can not be told apart. This is a problem for a couple of different reasons: first is this could be used to approximate the energy spent during the attach and release procedures more accurately, second is it would give way better options for designing a use case including e.g. software updates. The model handles this issue by always assuming a worst case scenario energy consumption, this however leads to the another issue. During the transmit phase is RX included, this lowers the power average power used here, as the model does not assume any relation between $T_{transmit}$ and the throughput. This is not a major issue, but is does not accurately describe most use cases. The third issue is a bit more hidden however, the parameter repetition was set to 1, this means that any transmission is rather short when this parameter is increase factors like the transmission gap comes into play this is not accounted for in the model. The forth issue is that the model uses a full attach procedure for each attach even when waking up from idle modes, this should not be the case in a real scenario, however as this issue makes the model underestimate the lifetime the design objective can still be evaluated.

Fixing these flaws in the model could indeed bring the accuracy of the model up, however it would also complicate the model further. As the model is intended to be as simple as possible, while still providing accurate estimates, this is not desired. To evaluate if the model actually predicts the battery life time accurately would require a longer test run, setting all the parameters and including idle mode and data transmission interval and evaluating the energy consumption over multiple days. This has however not been possible as the UXM used in the project is a shared resource. 

Another concern is that only four parameters was chosen out of a multitude of parameters. This of course could influence the estimate quite a bit. This has been accounted for indirectly, as more or less all of these parameters would affect the time a transmission takes, but not the average power consumption. A concern however is that repetition, not only affects the data transfer, but also the attach, release and paging messages. A few other parameters might also affect these procedures, in an uncertain way. Related to this, is also the fact that each value of the different parameters, has only been measured once, meaning any uncertainty for the individual points can not be evaluated. Also the fact that full independence between all the parameters has been assumed could be an issue. 

When all of these issues and concerns are taking into account, the model still predicts that the main influence of the battery lifetime is the transmit time and in the end this parameter is very much use case dependent. Other parameters are also highly influential such as the idle mode timer values, however the scenarios in which they are the main issue is considered quite unrealistic from an operators perspective. To increase the credibility of the model, the parameters that influence the time should be investigated. Some of the parameters affecting the transmit time has already been investigated by another group at Aalborg University \citep{NDS_report}.




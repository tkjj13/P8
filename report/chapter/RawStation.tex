\section{Data Processing}

Before concluding anything from the data, it is first analysed to check if the made assumptions are valid. The assumptions include a stationary channel, uncorrelated samples and finally that the data is Rayleigh distributed.

\subsection{Raw data}

In total 4.184.460 samples have been collected, the values are represented in \autoref{fig:rawFadingMeas}. Here all the space samples has been concatenated to visualize the data.

\begin{figure}[H]
\centering
\includegraphics[height = \textwidth, angle = -90]{figures/rawFadingMeas.pdf}
\caption{The measured samples spaced in frequency and space.}
\label{fig:rawFadingMeas}
\end{figure}


\subsection{Stationarity}
To see if the channel is stationary it has to be checked in both the frequency domain and the spatial domain. 

\textbf{Frequency domain}

The data is structured in 3 domains freq x antenna x walk/space, with N, M and K being the number of points in each dimension. To analyse stationarity in frequency an average is taken across the other two domains as:

\begin{equation}\label{eq:freqMean}
freqData(n) = \frac{1}{K\cdot M}\sum_{k = 1}^{K}\sum_{m = 1}^{M} data_{(n,m,k)}
\end{equation}

\begin{figure}[H]
\centering
%\includegraphics[height = \textwidth, angle = -90]{figures/meanFading.pdf}
\input{figures/meanFadingFreq.tex}
\caption{Average values across the frequency as per \autoref{eq:freqMean}, with values converted from linear scale to dB.}
\label{fig:meanFading}
\end{figure}

It can be seen that there is a drop of around 4 dB across the frequency, this drop can be explained by 2 factors first the antenna gain varies with around 2 dB across the frequency span \appref{ant_adix}, the other part is the \gls{PL} is dependent on frequency, by comparing PL of a free space path loss model, it can be seen that there is a drop of 1.75 dB going from 4.5 GHz to 5.5 GHz. Those two factors together can explain the drop in mean power across the span. As this can be explained the data is adjusted as:

\begin{equation}
data2 =  data \oslash \left(freqData\cdot ones(1,M,K)\right)
\end{equation}

\textbf{Spatial domain}

Likewise as the frequency domain the average is taken across the other domains, here it is assumed that the antennas even though spaced is a separate and stationary domain due to their closeness. The average is found based on the frequency corrected data as:

\begin{equation}\label{eq:spaceMean}
spaceData(k) = \frac{1}{N\cdot M}\sum_{n = 1}^{N}\sum_{m = 1}^{M} data2_{(n,m,k)}
\end{equation}

To visualize the data is restructured such that it matches the area it has been taken in see \autoref{Environment}. The data was collected by walking forth and back in the room with approx. 42 sweeps per meter or 210 sweeps per stretch. As every second stretch was walking back it has to be reversed to visualize the samples side by side. 


\begin{minipage}{0.9\textwidth}

\begin{figure}[H]
\centering
\captionsetup{belowskip=0em}
\begin{subfigure}[b]{0.326\textwidth}
\includegraphics[width=\textwidth]{figures/Not_Norm_space_1.png}
\caption{Low height \\ approx. 70 cm}
\label{Not_norm_low}
\end{subfigure}
\begin{subfigure}[b]{0.326\textwidth}
\includegraphics[width=\textwidth]{figures/Not_Norm_space_2.png}
\caption{Medium height \\ approx. 120 cm}
\label{Not_norm_medium}
\end{subfigure}
\begin{subfigure}[b]{0.326\textwidth}
\includegraphics[width=\textwidth]{figures/Not_Norm_space_3.png}
\caption{High height \\ approx. 170 cm}
\label{Not_norm_high}
\end{subfigure}
%\captionsetup{belowskip=-1.5em}
\caption{The measurements is restructured to be approximately where they was measured compared to each other.}
\label{fig:Not_norm_space}
\end{figure}
\end{minipage}%
\begin{minipage}{0.1\textwidth}
\begin{figure}[H]
\includegraphics[width=\textwidth]{figures/Not_Norm_space_colorbar.png}
\end{figure}
\end{minipage}

It can be seen from \autoref{fig:Not_norm_space} that the power level in the middle of the room is stronger than on the borders. The reason for this is believed to be the directionality of the transmit antenna. The transmit antenna was located outside and shooting in to the room as can be seen on \autoref{antennadoor}, so the main lobe might have been reflected from the wall directly to the middle of the measurement area. Because of this the area can not be said to be stationary so to combat this a moving average is used to normalize the mean power level across the area. The drawback of using a moving average is that it might affect the fading in the measurement, therefore as many point as possible should be in the average to make the influence as little as possible, however if too many points is in the average the stationarity issue would not be solved. It is chosen to average across 40 space samples.

\begin{equation}
MA = \frac{1}{40}\cdot \Big(spaceData*ones(40,1)\Big)
\end{equation}


%Note the reason for the spuriousness in the spatial domain has to do with the average being taken only over the 41 frequency samples at each position, where the the more smooth line in the frequency domain is an average across 102.060 samples in space. It can however be seen directly that the power level seems more or less constant across all spatial points, where it drops with frequency. This is expected as the \gls{PL} is dependent on the wavelength.  

%A condition that has to be met is that no dominant componet is present, to check this all samples are normalized with regards to the mean values seen in \autoref{fig:meanFading}, the normalize data is then fitted to a Rician distribution and the non-centrality parameter is found using matlabs \textit{fitdist} function as can be seen in \autoref{lst:a_value}. 

%\lstset{caption={Code implementation of the a value calculation.}, label=lst:a_value}
%\begin{lstlisting}
%% The measured values is stored in data which is a 41x102060 matrix with
%% the rows being frequency samples and the coloums being space samples
%
%PL = repmat(mean(data,2),1,102060);   % Determine PL by averaging across space dimension 
%dataN = data./PL;                     % Normalize data wrt. frequency
%dataS = reshape(dataN,41*102060,1);   % Reshape to vector format
%
%pd = fitdist(dataS,'Rician');         % Fit data to a Rician distribution
%pd.s                                  % Show non-centrality parameter for space domain
%
%PL = repmat(mean(data,1),41,1);       % Determine PL by averaging across frequency dimension
%dataN = data./PL;                     % Normalize data wrt. space
%dataF = reshape(dataN,41*102060,1);   % Reshape to vector format
%
%pd = fitdist(dataF,'Rician');         % Fit data to a Rician distribution
%pd.s                                  % Show non-centrality parameter for frequency domain
%\end{lstlisting}

%From this it can be found that the non-centrality parameter of the two domains are 0.0267 and 0.0319 for space and frequency domain respectively. That means that any dominant component is negligible compared to the random components, and it can therefore by concluded that the channel behaves stationary.

%\begin{figure}
%\input{figures/Norm_sapce_3.tex}
%\end{figure}
%\begin{figure}
%\input{figures/Not_Norm_sapce.tex}
%\end{figure}
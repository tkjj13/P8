\section{Relations (Not report ready (Thomas))}

\subsection{Physics relations}
Relation between wavelength and frequency
\begin{equation}
\lambda = \frac{c}{f}
\end{equation}

Maximum Doppler frequency assuming Jakes Doppler spectrum
\begin{equation}
f_D=\frac{v}{\lambda}
\end{equation}

Minimum bandwidth based on Doppler frequency
\begin{equation}
BW = 2\cdot f_D
\end{equation}

Noise power calculation
\begin{equation}
w = k \cdot T \cdot BW
\end{equation}

Proportionality between variables
\begin{equation}
w \propto BW \propto f \cdot v
\end{equation}

\begin{where}
\va{$\lambda$}{is the wavelength of the signal}{m}
\va{$c$}{is the speed of light}{$\frac{\text{m}}{\text{s}}$}
\va{$f$}{is the frequency of the signal}{Hz}
\va{$f_D$}{is the Doppler spread}{Hz}
\va{$v$}{is the relative velocity of the system}{$\frac{\text{m}}{\text{s}}$}
\va{$BW$}{is the Bandwidth of the system}{Hz}
\va{$w$}{is the noise in the system}{W}
\va{$k$}{is Boltzmans constant}{$\frac{\text{w}\cdot\text{s}}{\text{K}}$}
\va{$T$}{is the temperature of the system}{K}
\end{where}



\subsection{Statistical relations}
CDF of Rayleigh fading
\begin{equation}\label{rayleigh_CDF_std}
p(xs < x | \theta) = 1-exp\left(-\frac{x^2}{2\cdot \theta^2}\right)
\end{equation}


Rewritten to SNR
\begin{equation}\label{rayleigh_CDF}
p(SNR < SNRs | E\left(SNR\right)) = 1-exp\left(-\frac{SNRs}{E\left(SNR\right)}\right)
\end{equation}

Closer look at the ratio from \autoref{rayleigh_CDF}
\begin{equation}
\frac{SNRs}{E\left(SNR\right)} = \frac{\frac{xs}{w}}{E\left(\frac{xs}{w}\right)} = \frac{xs}{E\left(xs\right)} 
\end{equation}
It is seen the noise does not influence the fading gain. %\todo{why does the noise not influence this?}

Mean and variance of Rayleigh fading
\begin{equation}
\mu(x) = \theta\cdot\sqrt{\frac{\pi}{2}}
\end{equation}

\begin{equation}\label{rayleigh_var}
var(x) = \frac{4-\pi}{2}\cdot \theta^2
\end{equation}


Confidence interval at $1-\alpha$ level:
\begin{equation}\label{interval}
\bar{x} \pm z_{\frac{\alpha}{2}} \cdot \sqrt{\frac{var(x)}{N}}
\end{equation}

Based on \autoref{interval} assuming a interval threshold, A
\begin{equation}\label{interval2}
N \geq \left(z_{\frac{\alpha}{2}} \cdot \frac{\sqrt{var(x)}}{A} \right)^2
\end{equation}

Using the normal approximation of the binomial proportion we  estimate the number of samples with 90\% confidence level and an interval threshold of $\pm 25\%$ or 1 dB.Based on the Equation 1.12 we have for $ \bar{x} = 10^{-5} $ :
\begin{equation}\label{sampleEQ}
N=(1.645)^{2} \cdot \frac{1}{(0.25)^{2}} \cdot \frac{1-\bar{x}}{\bar{x}} = 4.3 \cdot 10^{6}
\end{equation}
Because the above procedure is an approximation we would generate $ 10 \cdot 10^{6} $ number of samples.
\subsection{Limitation for measurement purposes}

Strict limitations
\begin{equation}
SNRs > 1
\end{equation}

Other limitations
\begin{equation}
E\left(SNR\right) \;>\, \frac{1}{raylinv(p,\theta)} 
\end{equation}

\begin{where}
\va{$x$}{is the individual sample}{NA}
\va{$xs$}{is a treshold value for the samples}{NA}
\va{$\theta$}{is the mode of the distribution}{NA}
\va{$SNRs$}{is the threshold value of the signal-to-noise ratio}{1}
\va{$SNR$}{is the individual sample of the signal-to-noise ratio}{1}
\va{$N$}{number of samples}{1}
\va{$z_{\frac{\alpha}{2}}$}{is the normalize interval from a standard distribution}{NA}
\end{where}




\subsection{Further relations (Is this allowed?)}


From \autoref{rayleigh_CDF} and \autoref{rayleigh_CDF_std} it can be seen that
\begin{equation}\label{thetaVsSNR}
2\cdot\theta^2 = E\left(SNR\right)
\end{equation}

By combining \autoref{interval2} with \autoref{rayleigh_var} and \autoref{thetaVsSNR} the following relation can be obtained

\begin{equation}
N \geq \left(z_{\frac{\alpha}{2}} \cdot \frac{\sqrt{var(x)}}{A} \right)^2 = \left(\frac{z_{\frac{\alpha}{2}}}{A}\right)^2 \frac{4-\pi}{2}\cdot \theta^2 = \left(\frac{z_{\frac{\alpha}{2}}}{A}\right)^2 \cdot \frac{4-\pi}{2}\cdot \frac{E\left(SNR\right)}{2}
\end{equation}

From this relation the following proportionals can be found
\begin{equation}
N \propto E\left(SNR\right)\propto \frac{1}{w}
\end{equation}
\chapter{The wireless channel}
% \chapter{Channel Dynamics} possible other headline




\section{The idea of Multipath}
% (basic intro / symbol introduction)
%A general way to interpret communication is by assuming two persons Alice and Bob. When Alice successfully deliver her message to Bob the communication has been a success, unfortunately Charlie likes to tease Alice and Bob by interrupting the message while its under way, making the communication a failure. The interesting part here is what happens to the message under way that determines whether it results in a success or failure. 

%In wireless communication the path travelled is what is interesting, this is especially true when more than one path is possible.
%Communication happens when a message is transmitted from a to b
\todo {this part can be expanded upon use book from course chapter 6 intro}
In a wireless communication system the signal can reach the receiver from many different reflective paths. This is a phenomenon called multipath propagation. It has many effects on the signal, usually on its amplitude, phase and angle of arrival.\citep{Fading} A more specific term called multipath fading is used to describe these effects. Depending on those effects the receiver may experience constructive or distractive interference. Basically it means that the signal it might get amplified or attenuated depending on the interference. Strong distractive interference is usually called deep fade and can lead to failure of the communication system for a short period of time. Cause of the multipath fading the channel can be affected in certain ways.
	\begin{enumerate}
	\item Flat Fading : All the frequencies experience changes in amplitude over a period of time. That has as a result some reduction on the SNR.
	\item Selective Fading : Different frequencies across the channel experience different changes in phase and amplitude. Sometimes deep fades may observed in the channel, causing problem in the communication.\citep{FlatSelective}
	\end{enumerate}



	
\section{Rayleigh Fading}
% (confidence level vs number of samples)

%\section{Statistics}
%\subsection{Confidence Interval}
%\subsection{Distributions?}


Rayleigh fading is a propagation model that is used to describe situations where there are no line of sight connections and the signal may vary randomly due to scatterings. Usually this situation fits on an urban environment scenario with many buildings and obstacles.
In narrowband transmissions  the multipath propagation experiences rapid fading in the signal envelope and in the received spectrum the Doppler spread is clearly visible. The statistics of narrowband transmissions can be done by measuring on a  single frequency and the envelope will take the form of the Rayleigh distribution.

To do a measurement of a wireless channel need to have sufficient number of samples to have a certain error margin and confidence interval. To simplify one can only look at  the noise free case to see what different properties we can change to reduce the amount of samples we need. 
If we look at Rayleigh fading channels for a narrow band system the channel gain can be written as:

\begin{equation}
H(t) = \left [ \sum_{n =1}^{N} a_n(t)\cdot cos(\psi (t))\right ] + i\left [\sum_{n =1}^{N} a_n(t)\cdot sin(\psi (t))  \right ]
\end{equation}

If we assume that the random variables is not dependent on time, the impulse respond process $H(t)$ will be wide sense stationary. This means that the Real and imaginary parts can be treated as Gaussian processes with a mean of zero and equal variance. This gives a Rayleigh fading channel because $ \left | H(t) \right |^2 $ is a Rayleigh random variable.
A measurement has to measure the $ \left | H(t) \right |^2 $ and its estimation $ \mathop{\mathbb{E}}\left | H(t) \right |^2 $ this gives the power delay profile. To obtain some measurement samples of $ \left | H(t) \right |^2 $ one can transmit pilot symbols witch are identically disturbed and estimate the mean.\citep{MeasurementComplexRay}
These two variables has to fit to the Rayleigh fading. The mean value is given by the average across samples.
When measuring narrowband channels in a indoor environment the usual deep fades seen are not lower then -20 off the mean value of the signal. Due to the fact that only a small amount of samples are used (>100) the deep fades that the Rayleigh model predicts ($10^{-6}$) has such a low chance of happening that number of samples needs to be unreasonable high in a normal measuring case.
A  channel can be separated in  small scale and large scale fading. To determine small scale fading a sufficient number of measurements has to be made within a area where the large scale fading is constant.



\section{Coherence function}
\todo {update number of samples needed after statistics. I have assumed $10^7$}
The project have two connected parts, one where we investigate the proposed Rayleigh fading model and a part where we perform a measurement to see if it correct.  To model these extremely uncommon outages with low as $10^{-6}$ probability. To accomplish a measurement with some degree of accuracy (confidence interval) we must understand the statistics and the parts that affect it. One thing that is clear though is that many uncorrelated samples are needed. We will assume that we need $10^7$ uncorrelated samples to get some degree of accuracy for $10^{-6}$ probability. Now how do we get $10^7$ uncorrelated samples?
There are several physical limitations that need to be balanced  in order to prove the claims of the Rayleigh fading model with a predefined confidence interval and to obtain a large amount of uncorrelated samples.

Wireless multipath fading channels have varying factors in 3 types of domains. These domains are the temporal(time), frequency and spatial(space) domains \citep[p. 40-42]{stochasticWirelessChan}. These domains are connected and must be balanced to make the measurements possible. We have time constraints; as in we can't take measurements for several years. Space constraints; as we have a limited amount of space to measure. Frequency constraints; to get high enough dynamic range to see very severe fading (-60dB) we are limited on bandwidth.

Wireless channels autocorrelation is used to characterize how a random channel will change in time. So it is only dependant on one parameter. Autocorrelations can be found for the temporal(time), frequency and spatial(space) domains inherent to wireless random channels. The Power Spectral density is a measure of the average spectral power in a random channel. Doppler, delay and wave number spectra are defined and we can use Fourier transform to find the Autocorrelation. In reality we want to look at relationships between factors that affect a random channel, with the joint autocorrelation functions and joint PSDs\citep{SpaceWirelessChan}. The Fourier transform pair is as follows

\todo {rewrite this part os its easier to follow( break up into smaller steps), use wireless course and book as ref.}

\begin{equation}
D\mathcal{F} ( h(t,f,L) ) =
D\mathcal{F}^{-1} ( H(f_d,\tau,\Delta d) )
\end{equation}
$D\mathcal{F}$ is the double Fourier transform$t$ is absolute time,$f$ is frequency and $L$ position in space(1 dimension).
Where $f_d$ is the Doppler, $\tau$ is the time shift and $\Delta d$ is the separation in space (wave number).

We can simplify this and look at he Fourier transfer pairs in only two of the dimensions. Here is the time space relationship Fourier transform pair.
\begin{equation}
\mathcal{F} ( h(t,\Delta d) ) =
 S(f_d,\tau) )
\end{equation}
where $f_d$ is Doppler and $\Delta d$ is separation in space.

The measurement points needs to be spaced $\Delta d = \frac{\lambda}{2}$ to let the measurement points have independent fading. This is assuming a uniformly distributed angle of arrival given:
\begin{equation}
R_x[\Delta d] = J_0\cdot(2\pi \frac{\Delta d}{\lambda})
\end{equation}
Where $R_x$ is the autocorrelation function in space $\Delta d$ is the difference in distance. $J_0$ is the Bessel function with order 0.
We want the correlation to be 0 so the fade is uncorrelated.
\begin{equation}
\frac{2\pi \Delta d}{\lambda} = 2.512 \Leftrightarrow \Delta d = 0.4 \lambda \approx \frac{\lambda}{2}
\end{equation}

If the frequency is low then it might be difficult to have a sufficient amount of independent fading measuring points. \citep[p.11]{UWMeasurement} Too get uncorrelated  parallel measurement a antenna array with $\frac{\lambda}{2}$ separated antennas can be used for multi probe measurements. A antenna array will multiply the number of samples measured at each time interval of the reviver and transmitter. So a $5\cdot 5$ antenna array would gives us $5^2 = 25$ uncorrelated channels each measurement.

The other part of the Fourier transfer pairs is the time frequency relationship joint PSD and Autocorrelation:
\begin{equation}
\mathcal{F} ( h(t,f) ) =
 S(f_d,\tau) )
\end{equation}
Where $t$ is time and $f$ is frequency. The autocorrelation function $S{f_d,\tau}$ is defined by the Doppler $f_d$ and the delay $\tau$



The sample size can be further increase by using uncorrelated samples in the frequency domain. 
For samples to be uncorrelated a frequency separation $\Delta f$  is needed. This has to be as big as the coherence BW. $B_{c}$. $B_{c}$ is statistical and measurement dependant on the relationship between different frequencies over the channel that has a strong correlation.The Fourier transform of the PDP gives the Frequency correlation function that is used for determining the coherence bandwidth of the channel. This is dependant on the actual environment in which measurements are conducted. A exact value has to be determined from  an actual measurement of the channel, but there are approximations\citep{RayFadeHandbook}. The RMS delay spread $\sigma_{\tau}$ is given by:
\begin{equation}
\sigma_{\tau} = \sqrt{\bar{\tau} - {(\bar{\tau}^{2})}}
\end{equation}
Where $\bar{\tau}$ is the mean excess delay $(\bar{\tau}^{2})$ is 
the second central moment of $H(\tau)$. With the RMS delay spread we can find $B_c$ by approximation:
\begin{equation}
B_C \geq \frac{1}{2\pi \cdot \sigma_{\tau}}
\label{CohBW}
\end{equation}
This will gives us a $B_c$ approximation that has a coherence under 0.5. 
\citep{CohBW}
If we look at a example from lecture at AAU we got a $B_c$ of 10 Mhz in a multipath lab environment.
\todo{might be somthing wrong with the matlab script, because the FCF shows more BW} With a delay profile of around 20ns. So in a small environment with small delay profile a larger $\Delta f$ is needed to have samples uncorrelated.
\citep[Chapter 18.5]{ComHandbook}

\subsection{How to measure uncorrelated samples}
\todo {rewrite in more general term and then use example values or make table}
To measure the required samples from \autoref{sampleEQ} ($\approx 10^7$) uncorrelated samples requires a elaborate test setup. The limitation is in how much space and time the measurement is going to require. The example scenario  will have a $f_c$ of 3Ghz, BW of 100MHz, a $5x5$ antenna array, a office building with a delay spread of 100ns and a room size that is $10m \cdot 10m \cdot 2.5m$.
If we assume we have a multipath delay spread of 100ns. Given \autoref{CohBW} the $B_C$ is 1.6MHz. Since the $B_C$ is only a approximation with some coherence, the $B_C$ should be increased to approximate 3 Mhz to get less correlated samples. This will give round 30 uncorrelated samples in frequency with a BW of 100MHz.
The $f_c$ of 3Ghz gives a $\lambda$ of 0.1m or 10cm. The array antennas has each antenna spaced half a $\lambda$ which would give a total antenna length of 0.25m. If the antenna array is moved in one dimension,every step needs to be spaced $0.25+\frac{\lambda}{2}$ apart. Given the 10m size of the room 30 samples is possible in 1 dimension. If the measurements is done in 2 dimensions ($10m\cdot 10m$) a total area of:
\todo {Re write equations so you find the VOLUME required and not use
 actually values, write it more general}
\begin{equation}
N = A_{div} \cdot \frac{BW}{B_c \cdot 2} \cdot \frac{V}{(\frac{\lambda}{2})^2}
\label{howtosample}
\end{equation} 

\begin{equation}
\Delta = \frac{N\cdot (\frac{\lambda}{2})^3}{A_{div}\cdot \frac{BW}{B_c \cdot 2}}
\label{howtosqaure}
\end{equation}
If we assume a $10m \cdot 10m$ this gives us: 
\begin{equation}
\frac{10m}{\frac{\lambda}{2}} \cdot \frac{10m}{\frac{\lambda}{2}}  = 40000 samples
\end{equation}
The total amount of spatial, frequency and antenna array uncorrelated samples is:
\begin{equation}
30 \cdot 25 \cdot 40000 = 3 \cdot 10^7 samples
\end{equation}
which is way more then we need.
Actually moving the reviver $2 \cdot 10^6$ times takes way to long to actually do, but this example calculation is just to show that it is possible to obtain $10^7$ samples.If the area of the measurement is not big enough to take all the measurements different rooms could be used. To do this you need to normalize for the mean gain the system sees. 

A other problem with a taking $10^7$ samples is that the channel may be changing because of frequency shift or movement. This will make the samples uncorrelated, but you are in danger of measuring a completely different channel. Here comes the non-stationary principle into play. A argument could be made that the $10^{-6}$ fading is so dependant on the environment that a measurement would only be valid for this exact room or situation you are measuring.

\section{Doppler}
In the frequency domain we must have a bandwidth larger than our Doppler spread. Doppler spread is given by:
\begin{equation}
Doppler Spread = 2/\lambda \cdot v
\end{equation}
Where $\lambda$ is wavelength and $v$ is velocity.

If we assume the system is moving slowly at $5m/s$ and we use a open $2.4Ghz$ frequency we can see that the Doppler spread is 80Hz. This means our bandwidth can't be lower than 80Hz. We know that the dynamic range of a VNA is dependant on the measurement bandwidth, and that we should use as low BW as possible. This means that we will set our BW to 80Hz. A 80Hz bandwidth is very narrow and will give us little frequency dependant fading and we can assume frequency flat fading. So we can remove the delay spectra ; frequency domain to simplify our joint PSD. So we can only look at space and time joint PSD.

\section{Introduction of noisy signal}